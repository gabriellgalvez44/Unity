<!DOCTYPE html>
<html lang=en theme=dark>
<head>
<title>Unity Scripts - CameraRotator.cs</title>
</head>
<body>
<section>
<button onclick="window.location.href='../index.html'"><- Back...</button>
</section>
<section>
<left>
<h1>CameraRotator.cs</h1>
<button onclick="window.open('https://drive.google.com/uc?export=download&id=1H1lw20c8D353fb4glPSr8IuRl5LtHKV5')">Download</button>
<h1>Version 14:</h1>
This script is used to allow the camera to rotate in a 3D space with your mouse
<h1>Method names:</h1>
UnlockCursor<br>
LockCursor
</left>
<right>
<textarea readonly>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.InputSystem;

public class CameraRotator : MonoBehaviour
{
    [Header("Client & player identifyer")]
    public Transform playerBody;
    [Header("Cursor")]
    public GameObject hudObject;
    public bool autoLockCursor = true;
    public bool leftClickLock = true;
    public bool cursorLocked = false;
    public GameControl GameControllerObject;
    public float cursorUnlockedGameSpeed = 0f;
    [Header("Camera control")]
    public float mouseSensitivity = 100f;
    public bool lockDirectVertical = true;
    public float lockOnDegrees = 90f;
    public string seeThroughTag;
    [Header("Rotation")]
    public float cameraX;
    public float cameraY;
    [HideInInspector] public bool canRotate = true;
    private int rep = 25;
    [Header("Interval rotation")]
    public bool useInterval = false;
    public float interval = 45f;
    public float speed = 0.25f;
    private bool isChildOfPlayer;
    private Camera seeThroughCam;
    private Camera mainCamera;
    private bool lastCursorLockedState;
    private float originalTimeSpeed;
    private void Start()
    {
        originalTimeSpeed = GameControllerObject.timeSpeed;
        mouseSensitivity *= .75f;
        speed *= 10;
        if (autoLockCursor)
        {
            LockCursor();
        }
        cursorLocked = Cursor.lockState == CursorLockMode.Locked;
        lastCursorLockedState = cursorLocked;
        if (playerBody != null)
        {
            Transform parent = transform.parent;
            while (parent != null)
            {
                if (parent == playerBody)
                {
                    isChildOfPlayer = true;
                    break;
                }
                parent = parent.parent;
            }
        }
        if (string.IsNullOrEmpty(seeThroughTag))
            return;
        mainCamera = GetComponent<Camera>();
        if (mainCamera == null)
            return;
        GameObject seeThroughCamObj = new GameObject("SeeThroughCamera");
        seeThroughCamObj.transform.SetParent(transform, false);
        seeThroughCam = seeThroughCamObj.AddComponent<Camera>();
        seeThroughCam.CopyFrom(mainCamera);
        int tempLayer = 31;
        GameObject[] seeThroughObjects = GameObject.FindGameObjectsWithTag(seeThroughTag);
        foreach (GameObject obj in seeThroughObjects)
        {
            obj.layer = tempLayer;
        }
        seeThroughCam.cullingMask = 1 << tempLayer;
        seeThroughCam.clearFlags = CameraClearFlags.Depth;
        seeThroughCam.depth = mainCamera.depth + 1;
        mainCamera.cullingMask &= ~(1 << tempLayer);
    }
    private void Update()
    {
        if (Keyboard.current != null && Keyboard.current.escapeKey.wasPressedThisFrame)
        {
            UnlockCursor();
        }
        if (Mouse.current != null && Mouse.current.leftButton.wasPressedThisFrame && leftClickLock)
        {
            LockCursor();
        }
        cursorLocked = Cursor.lockState == CursorLockMode.Locked;
        if (cursorLocked != lastCursorLockedState)
            lastCursorLockedState = cursorLocked;
        hudObject.SetActive(!cursorLocked);
        if (!cursorLocked)
            return;
        Vector2 mouseDelta = Vector2.zero;
        if (Mouse.current != null)
        {
            mouseDelta = Mouse.current.delta.ReadValue();
        }
        float mouseX = mouseDelta.x * mouseSensitivity * Time.deltaTime;
        float mouseY = mouseDelta.y * mouseSensitivity * Time.deltaTime;
        if (rep > 0)
        {
            rep--;
            mouseX = 0;
            mouseY = 0;
        }
        if (canRotate)
        {
            cameraX += mouseX;
            cameraY -= mouseY;
        }
        if (lockDirectVertical)
        {
            cameraY = Mathf.Clamp(cameraY, -lockOnDegrees, lockOnDegrees);
        }
        if (isChildOfPlayer)
        {
            transform.localRotation = Quaternion.Euler(cameraY, cameraX - playerBody.eulerAngles.y, 0f);
        }
        else
        {
            transform.localRotation = Quaternion.Euler(cameraY, cameraX, 0f);
        }
    }
    private void FixedUpdate()
    {
        if (!cursorLocked)
            return;
        if (useInterval && playerBody != null)
        {
            float cameraYaw = cameraX;
            float bodyYaw = playerBody.eulerAngles.y;
            float yawDifference = Mathf.DeltaAngle(bodyYaw, cameraYaw);
            if (Mathf.Abs(yawDifference) >= interval)
            {
                float targetYaw = Mathf.MoveTowardsAngle(bodyYaw, cameraYaw, speed * 100f * Time.deltaTime);
                playerBody.rotation = Quaternion.Euler(0f, targetYaw, 0f);
            }
        }
    }
    public void UnlockCursor()
    {
        Cursor.lockState = CursorLockMode.None;
        Cursor.visible = true;
        GameControllerObject.timeSpeed = cursorUnlockedGameSpeed;
    }
    public void LockCursor() {
        Cursor.lockState = CursorLockMode.Locked;
        Cursor.visible = false;
        GameControllerObject.timeSpeed = originalTimeSpeed;
    }
}</textarea>
</right>
</section>
</body>
<script src=https://gabriellgalvez44.github.io/Data/shorten.js></script>
<link rel=stylesheet href=../script.css>
</html>
